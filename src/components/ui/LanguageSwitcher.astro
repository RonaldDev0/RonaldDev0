---
const { currentLang = 'en' } = Astro.props;
const languages = [
  { code: 'en', label: 'English', path: '/', flag: 'us' },
  { code: 'es', label: 'Espa√±ol', path: '/es/', flag: 'es' }
];

function getFlag(code: string) {
  if (code === 'es') {
    return `<svg width='20' height='20' viewBox='0 0 60 60' aria-hidden='true'><rect width='60' height='60' fill='#aa151b'/><rect y='15' width='60' height='30' fill='#f1bf00'/></svg>`;
  }
  // USA flag
  return `<svg width='20' height='20' viewBox='0 0 60 60' aria-hidden='true'><rect width='60' height='60' fill='#b22234'/><g><rect y='5' width='60' height='5' fill='#fff'/><rect y='15' width='60' height='5' fill='#fff'/><rect y='25' width='60' height='5' fill='#fff'/><rect y='35' width='60' height='5' fill='#fff'/><rect y='45' width='60' height='5' fill='#fff'/><rect y='55' width='60' height='5' fill='#fff'/></g><rect width='24' height='24' fill='#3c3b6e'/><g fill='#fff'><circle cx='3' cy='3' r='1.2'/><circle cx='9' cy='3' r='1.2'/><circle cx='15' cy='3' r='1.2'/><circle cx='21' cy='3' r='1.2'/><circle cx='6' cy='6' r='1.2'/><circle cx='12' cy='6' r='1.2'/><circle cx='18' cy='6' r='1.2'/><circle cx='3' cy='9' r='1.2'/><circle cx='9' cy='9' r='1.2'/><circle cx='15' cy='9' r='1.2'/><circle cx='21' cy='9' r='1.2'/><circle cx='6' cy='12' r='1.2'/><circle cx='12' cy='12' r='1.2'/><circle cx='18' cy='12' r='1.2'/><circle cx='3' cy='15' r='1.2'/><circle cx='9' cy='15' r='1.2'/><circle cx='15' cy='15' r='1.2'/><circle cx='21' cy='15' r='1.2'/><circle cx='6' cy='18' r='1.2'/><circle cx='12' cy='18' r='1.2'/><circle cx='18' cy='18' r='1.2'/><circle cx='3' cy='21' r='1.2'/><circle cx='9' cy='21' r='1.2'/><circle cx='15' cy='21' r='1.2'/><circle cx='21' cy='21' r='1.2'/></g></svg>`;
}

const activeLang = languages.find(l => l.code === currentLang) || languages[0];
---

<details class='relative inline-block group'>
  <summary class='flex items-center gap-2 px-3 py-1.5 rounded-md border border-border bg-background text-foreground text-sm font-medium shadow-sm transition-all duration-200 cursor-pointer list-none hover:bg-accent hover:border-primary group-open:bg-accent group-open:border-primary' aria-haspopup='listbox'>
    <span class='inline-block' set:html={getFlag(activeLang.code)}></span>
    <span>{activeLang.label}</span>
    <svg class='ml-1 w-4 h-4 transition-transform duration-200 group-open:rotate-180' viewBox='0 0 20 20' fill='none' aria-hidden='true'><path d='M6 8l4 4 4-4' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/></svg>
  </summary>
  <div class='absolute right-0 sm:right-0 sm:left-auto left-0 mt-2 min-w-[120px] bg-background border border-border rounded-md shadow-lg z-50 flex flex-col py-1' role='listbox'>
    {languages.map(lang => (
      <a
        href={lang.path}
        class='flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-md transition-colors duration-200 cursor-pointer text-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground aria-current={currentLang === lang.code ? 'page' : undefined}'
        aria-current={currentLang === lang.code ? 'page' : undefined}
        hreflang={lang.code}
        aria-label={lang.label}
        tabindex='0'
      >
        <span class='inline-block' set:html={getFlag(lang.code)}></span>
        <span>{lang.label}</span>
      </a>
    ))}
  </div>
</details> 